<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Memoria Arcade Navideña</title>
    <style>
        :root { --noche: #0A192F; --adviento: #6A0573; --oro: #FFD700; }
        body { margin: 0; background: var(--noche); font-family: sans-serif; color: white; display: flex; flex-direction: column; align-items: center; min-height: 100vh; overflow-x: hidden; }
        #header { width: 100%; padding: 15px; background: var(--adviento); display: flex; justify-content: space-around; border-bottom: 3px solid var(--oro); font-weight: bold; box-sizing: border-box; }
        #game-board { margin: 20px auto; width: 95vw; max-width: 400px; display: grid; gap: 10px; justify-content: center; }
        .card { aspect-ratio: 1/1; cursor: pointer; position: relative; transform-style: preserve-3d; transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        .card.flipped { transform: rotateY(180deg); }
        .card-front, .card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 12px; border: 3px solid var(--oro); box-sizing: border-box; }
        .card-back { background: var(--adviento); display: flex; align-items: center; justify-content: center; font-size: 2rem; color: var(--oro); box-shadow: 0 4px 8px rgba(0,0,0,0.3); }
        .card-front { transform: rotateY(180deg); background-size: cover; background-position: center; background-color: white; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(10, 25, 47, 0.98); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 999; text-align: center; }
        .btn { background: var(--adviento); color: white; border: 2px solid var(--oro); padding: 12px 25px; border-radius: 50px; font-size: 1.1rem; cursor: pointer; margin-top: 15px; font-weight: bold; }
    </style>
</head>
<body>

    <div id="header">
        <div>NIVEL: <span id="lvl">1</span>/5</div>
        <div>INTENTOS: <span id="tries">0</span></div>
    </div>

    <div id="game-board"></div>

    <div id="scr-start" class="overlay">
        <h1 style="color:var(--oro)">MEMORIA ARCADE</h1>
        <p>¡Busca los pares con sonido retro!</p>
        <button class="btn" onclick="startGame()">¡EMPEZAR!</button>
    </div>

    <div id="scr-msg" class="overlay" style="display:none">
        <h1 id="msg-t" style="color:var(--oro)"></h1>
        <p id="msg-b"></p>
        <button id="msg-btn" class="btn">SIGUIENTE</button>
    </div>

    <script>
        // MOTOR DE AUDIO RETRO (SINTETIZADOR OSCILADOR)
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playTone(freq, duration, type = 'square', vol = 0.1) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(vol, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        const sounds = {
            start: () => {
                [440, 554, 659, 880].forEach((f, i) => setTimeout(() => playTone(f, 0.4, 'sine'), i * 150));
            },
            flip: () => playTone(600, 0.1, 'triangle'),
            match: () => {
                playTone(800, 0.2, 'square');
                setTimeout(() => playTone(1200, 0.3, 'square'), 100);
            },
            error: () => playTone(150, 0.3, 'sawtooth'),
            win: () => {
                [523, 659, 783, 1046].forEach((f, i) => setTimeout(() => playTone(f, 0.5, 'square'), i * 100));
            }
        };

        const COLECCION_IMAGENES = [
            'https://cdn-icons-png.flaticon.com/512/2311/2311540.png',
            'https://cdn-icons-png.flaticon.com/512/2311/2311543.png',
            'https://cdn-icons-png.flaticon.com/512/2311/2311531.png',
            'https://cdn-icons-png.flaticon.com/512/2311/2311553.png',
            'https://cdn-icons-png.flaticon.com/512/2311/2311565.png',
            'https://cdn-icons-png.flaticon.com/512/2311/2311526.png',
            'https://cdn-icons-png.flaticon.com/512/2311/2311521.png',
            'https://cdn-icons-png.flaticon.com/512/2311/2311551.png',
            'https://cdn-icons-png.flaticon.com/512/4117/4117079.png',
            'https://cdn-icons-png.flaticon.com/512/1047/1047640.png'
        ];
        
        let level = 1, tries = 0, flippedCards = [], matchedPairs = 0;

        function startGame() {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            document.getElementById('scr-start').style.display = 'none';
            sounds.start();
            loadLevel();
        }

        function loadLevel() {
            const board = document.getElementById('game-board');
            board.innerHTML = '';
            tries = 0; matchedPairs = 0; flippedCards = [];
            document.getElementById('tries').innerText = tries;
            document.getElementById('lvl').innerText = level;

            let config = [
                {cols: 2, rows: 2}, {cols: 3, rows: 2}, {cols: 4, rows: 2}, {cols: 4, rows: 3}, {cols: 4, rows: 4}
            ];
            
            let current = config[level - 1];
            board.style.gridTemplateColumns = `repeat(${current.cols}, 1fr)`;
            let pairsNeeded = (current.cols * current.rows) / 2;

            let selectedImages = [...COLECCION_IMAGENES].sort(() => Math.random() - 0.5).slice(0, pairsNeeded);
            let gameSet = [...selectedImages, ...selectedImages].sort(() => Math.random() - 0.5);

            gameSet.forEach(imgUrl => {
                const card = document.createElement('div');
                card.classList.add('card');
                card.dataset.img = imgUrl;
                card.innerHTML = `<div class="card-front" style="background-image:url(${imgUrl})"></div><div class="card-back">❄️</div>`;
                card.onclick = () => flipCard(card);
                board.appendChild(card);
            });
        }

        function flipCard(card) {
            if (flippedCards.length < 2 && !card.classList.contains('flipped')) {
                sounds.flip();
                card.classList.add('flipped');
                flippedCards.push(card);
                if (flippedCards.length === 2) {
                    tries++;
                    document.getElementById('tries').innerText = tries;
                    checkMatch();
                }
            }
        }

        function checkMatch() {
            const [c1, c2] = flippedCards;
            if (c1.dataset.img === c2.dataset.img) {
                matchedPairs++;
                flippedCards = [];
                sounds.match();
                if (matchedPairs === (document.getElementById('game-board').children.length / 2)) {
                    setTimeout(() => {
                        sounds.win();
                        if (level < 5) {
                            msg("¡BIEN HECHO!", `Nivel ${level} superado.`, "SIGUIENTE", () => { level++; loadLevel(); });
                        } else {
                            msg("¡ERES UN CRACK!", "¡Juego completado!", "REINICIAR", () => location.reload());
                        }
                    }, 600);
                }
            } else {
                setTimeout(() => {
                    sounds.error();
                    c1.classList.remove('flipped');
                    c2.classList.remove('flipped');
                    flippedCards = [];
                }, 800);
            }
        }

        function msg(t, b, btn, act) {
            document.getElementById('msg-t').innerText = t;
            document.getElementById('msg-b').innerText = b;
            const bE = document.getElementById('msg-btn');
            bE.innerText = btn;
            bE.onclick = () => { document.getElementById('scr-msg').style.display='none'; act(); };
            document.getElementById('scr-msg').style.display='flex';
        }
    </script>
</body>
</html>
