<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asistencia QR | Hermandad de la S.V. del Carmen de Lima</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Georgia:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
<style>
    /* ========================================================== */
    /* Estilos CSS Base y Variables */
    /* ========================================================== */

    :root {
        --color-primario-fondo: #FFF8E1; 
        --color-secundario-fondo: #FEFBEA; 
        --color-acento-base: #A0522D; 
        --color-acento-oscuro: #5D4037; 
        --color-texto-oscuro: #3E2723; 
        --color-exito: #4CAF50; 
        
        --sombra-elegante: 0 10px 20px rgba(0, 0, 0, 0.15), 0 4px 8px rgba(0, 0, 0, 0.1);
        --degradado-acento: linear-gradient(135deg, var(--color-acento-base) 0%, var(--color-acento-oscuro) 100%); 
        --degradado-fondo-pagina: linear-gradient(180deg, #FAF0E6 0%, #FFFDE7 100%);
    }

    body {
        font-family: 'Poppins', sans-serif;
        margin: 0;
        padding: 0;
        background: var(--degradado-fondo-pagina);
        color: var(--color-texto-oscuro);
        line-height: 1.6;
        min-height: 10vh;
    }
    
    /* Preloader */
    #preloader {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background-color: var(--color-primario-fondo); z-index: 9999; 
        display: flex; flex-direction: column; justify-content: center; align-items: center;
        opacity: 1; visibility: visible; transition: opacity 1s ease-out, visibility 1s ease-out; 
    }
    #preloader.hidden { opacity: 0; visibility: hidden; }
    .loader {
        width: 60px; height: 60px; border: 6px solid var(--color-secundario-fondo);
        border-top: 6px solid var(--color-acento-base); border-radius: 50%; 
        animation: spin 1.2s linear infinite; margin-bottom: 20px; 
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    
    /* Contenedor Principal */
    .contenedor {
        width: 95%; max-width: 900px; margin: 30px auto; 
        background: linear-gradient(to right, #FFF8E1 0%, #FEFBEA 100%);
        box-shadow: var(--sombra-elegante); border-radius: 20px; padding: 30px 20px;
        opacity: 0; transform: translateY(20px);
        transition: opacity 1s ease-in-out 1s, transform 1s ease-in-out 1s; 
    }
    .contenedor.visible { opacity: 1; transform: translateY(0); }
    
    /* ---------------------------------------------------------- */
    /* ENCABEZADO - AJUSTE PARA UN SOLO LOGO (CENTRAL) */
    /* ---------------------------------------------------------- */
    .main-header { 
        text-align: center; 
        padding-bottom: 20px; 
        border-bottom: 3px double var(--color-acento-base); 
        margin-bottom: 20px; 
    }

    .header-logo-container { 
        display: flex; 
        flex-direction: column; /* Centrar verticalmente */
        justify-content: center; 
        align-items: center; 
        margin-bottom: 10px; 
    }

    /* Contenedor del √önico Logo (Hermandad) */
    .logo-header { 
        width: 90px; /* Tama√±o del logo */
        height: 90px; 
        margin: 0 auto 10px auto; /* Centrar y darle margen inferior */
    }

    .logo-header img { 
        max-width: 100%; 
        max-height: 100%; 
        object-fit: contain; 
    }

    .header-texto { 
        /* En modo de un solo logo, el texto ocupa todo el ancho */
        max-width: 100%; 
    }
    .header-texto h1 { 
        color: var(--color-acento-oscuro); 
        font-family: 'Georgia', serif; 
        font-size: 1.6em; /* Aumentado */
        margin-bottom: 3px; 
        text-transform: uppercase; 
        line-height: 1.2;
    }
    .header-texto h2 { 
        font-size: 1em; 
        margin: 0; 
        color: var(--color-acento-base); 
        font-weight: 500; 
    }
    
    /* Bot√≥n Principal */
    .btn-main {
        background: var(--degradado-acento); color: white; padding: 15px 35px; text-decoration: none;
        border-radius: 50px; font-size: 1.1em; font-weight: 700; letter-spacing: 1px;
        transition: all 0.3s ease; border: none; display: inline-block; 
        text-transform: uppercase; cursor: pointer; 
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    /* Estilo del bot√≥n de b√∫squeda */
    #step2 .btn-main {
        animation: none;
    }

    .btn-main:hover {
        background: linear-gradient(135deg, var(--color-acento-oscuro) 0%, var(--color-acento-base) 100%);
        transform: translateY(-2px) scale(1.01);
    }
    .btn-main:disabled {
        background: #CCC;
        cursor: not-allowed;
        animation: none;
        box-shadow: none;
    }
    
    /* ---------------------------------------------------------- */
    /* ESTILOS DE FASES Y TRANSICI√ìN */
    /* ---------------------------------------------------------- */
    
    #stepContainer {
        position: relative;
        overflow: hidden; 
        min-height: 380px; 
        padding: 0;
    }

    .step-content {
        position: absolute;
        width: 100%;
        top: 0;
        left: 0;
        padding: 20px; 
        opacity: 0;
        visibility: hidden; 
        transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out, visibility 0.5s;
        box-sizing: border-box;
        text-align: center;
        background-color: var(--color-secundario-fondo);
        border-radius: 12px;
        border: 1px solid #E0E0E0;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        min-height: 380px; 
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    /* Fase Visible (Clase 'active') */
    .step-content.active {
        position: relative; 
        opacity: 1;
        visibility: visible; 
        transform: translateX(0);
        margin: 0;
    }
    
    .step-icon {
        font-size: 4em;
        color: var(--color-acento-base);
        margin-bottom: 20px;
    }
    .step-icon.success { color: var(--color-exito); }

    /* Estilos del Formulario (Paso 2) */
    .input-group {
        margin-top: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 90%; 
        max-width: 350px;
    }
    .input-group label {
        align-self: flex-start;
        font-weight: 600;
        margin-bottom: 5px;
        color: var(--color-acento-oscuro);
    }
    .input-group input {
        width: 100%;
        padding: 12px;
        font-size: 1.1em;
        border: 2px solid #DDD;
        border-radius: 8px;
        text-align: center;
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    /* Estilo del QR en Pantalla (Paso 3) */
    #qr-placeholder {
        margin: 20px auto; 
        border: 4px solid var(--color-acento-base); 
        border-radius: 8px; 
        padding: 10px;
        max-width: 180px; 
    }
    #qr-placeholder img {
        width: 150px; 
        height: 150px;
    }


    /* Estilos de Botones Secundarios */
    .btn-secondary {
        background-color: #999;
        color: white;
        padding: 12px 25px;
        border: none;
        border-radius: 50px;
        font-size: 1em;
        margin-left: 10px;
        cursor: pointer;
        transition: background-color 0.3s;
    }
    .btn-secondary:hover {
        background-color: #777;
    }

    /* ---------------------------------------------------------- */
    /* FORMATO PDF (Oculto) */
    /* ---------------------------------------------------------- */
    #qrCardFormat {
        width: 500px; 
        padding: 30px; 
        box-sizing: border-box;
        border: 4px solid var(--color-acento-oscuro); 
        border-radius: 20px; 
        background-color: white;
        text-align: center;
        position: absolute; 
        left: -9999px;
        font-family: 'Poppins', sans-serif; 
    }
    .card-logo {
        width: 80px; 
        height: 80px;
        margin-bottom: 8px;
    }
    /* Resto de estilos PDF se mantiene igual para calidad de impresi√≥n */


    /* ---------------------------------------------------------- */
    /* Responsive Design (Menos de 600px) */
    /* ---------------------------------------------------------- */
    @media (max-width: 600px) {
        .contenedor { padding: 20px 10px; }
        
        /* En m√≥vil, el logo ya est√° en una l√≠nea diferente (encima del texto) */
        .logo-header {
            width: 70px; /* Reducci√≥n de tama√±o en m√≥vil */
            height: 70px;
            margin-bottom: 8px;
        }

        .header-texto h1 { font-size: 1.3em; line-height: 1.1; }
        .header-texto h2 { font-size: 0.9em; }

        .step-icon { font-size: 3em; }
        .step-content { min-height: 300px; padding: 10px; }
        .btn-main { padding: 10px 20px; font-size: 0.9em; }
        .btn-secondary { padding: 8px 15px; font-size: 0.8em; margin-left: 5px; }
        .input-group { max-width: 90%; }
        
        #hermano-info h4 { font-size: 1.1em; }
        #verifiedGroupName { font-size: 0.9em; }
    }
</style>
</head>
<body>
    
    <div id="preloader">
        <div class="loader"></div>
        <div class="loader-text">Preparando el Sistema de Asistencia...</div>
    </div>

    <div class="contenedor" id="mainContainer">
        <div class="main-header">
            <div class="header-logo-container">
                
                <div class="logo-header">
                    <img src="https://edwinhsvcl14-maker.github.io/asistencias/logo_hermandad.png" alt="Logo de la Hermandad">
                </div>
                
                <div class="header-texto">
                   
                    <h1>SISTEMA DE ASISTENCIA AUTOM√ÅTICA</h1>
                    <h2 id="headerGroupName">Hermandad de la Sant√≠sima Virgen del Carmen de Lima11</h2> 
                    <h2 id="headerGroupName">Generaci√≥n de C√≥digo QR</h2> 

                </div>
                
                </div>
        </div>

        <div id="stepContainer">
            
            <div id="step1" class="step-content active">
                <i class="fas fa-qrcode step-icon"></i>
                <h3 style="color: var(--color-acento-oscuro);">¬°Bienvenidos al Futuro de la Asistencia!</h3>
                <p style="max-width: 600px; font-size: 1.05em; color: var(--color-texto-oscuro); text-align: center;">
                    Este sistema permite generar su **C√≥digo QR personal** para registrar su asistencia de manera eficiente y transparente.
                </p>
                <p style="max-width: 600px; font-size: 0.95em; font-style: italic;">
                    Haga clic para iniciar el proceso de verificaci√≥n y descarga.
                </p>
                <button class="btn-main" onclick="nextStep(2)">Comenzar Proceso <i class="fas fa-arrow-right"></i></button>
            </div>
            
            <div id="step2" class="step-content">
                <i class="fas fa-id-card step-icon"></i>
                <h3 style="color: var(--color-acento-oscuro);">Paso 1: Verificaci√≥n de Hermano(a)</h3>
                <p>Por favor, ingrese su **N√∫mero de DNI** para verificar su registro.</p>
                
                <div class="input-group">
                    <label for="dniInput">N√∫mero de DNI (8 d√≠gitos)</label>
                    <input type="text" id="dniInput" maxlength="8" placeholder="Ej: 12345678">
                </div>
                
                <div id="error-message" style="display: none;"></div>
                
                <button class="btn-main" style="margin-top: 30px;" onclick="verifyDNI()">
                    <i class="fas fa-search"></i> Buscar Hermano(a)
                </button>
            </div>
            
            <div id="step3" class="step-content">
                <i class="fas fa-check-circle step-icon success" id="statusIcon"></i>
                <h3 style="color: var(--color-exito);">¬°Hermano(a) Verificado con √âxito!</h3>
                
                <div id="hermano-info">
                    <p style="font-size: 1.2em; font-weight: 600;">Bienvenido(a):</p>
                    <h4 id="hermanoNombre"></h4>
                    <p id="verifiedGroupName" style="font-style: italic; color: var(--color-acento-base);"></p> 
                    <p>Su C√≥digo QR personal est√° listo para ser generado y descargado en formato **PDF**.</p>
                </div>
                
                <div id="qr-placeholder">
                    <img src="https://placehold.co/150x150/A0522D/FFF8E1?text=QR+LISTO" alt="C√≥digo QR Personal" id="qrImage">
                </div>

                <div style="display: flex; margin-top: 15px;">
                    <button class="btn-main" onclick="downloadPDF()">
                        <i class="fas fa-file-pdf"></i> Descargar Tarjeta QR (PDF)
                    </button>
                    <button class="btn-secondary" onclick="nextStep(1)">
                        <i class="fas fa-redo"></i> Volver a Empezar
                    </button>
                </div>
            </div>

        </div>
        <div id="qrCardFormat">
            <div class="card-header">
                <img src="https://edwinhsvcl14-maker.github.io/asistencias/logo_hermandad.png" alt="Logo Hermandad" class="card-logo"> 
                <h4>Hermandad de la Sant√≠sima Virgen del Carmen de Lima</h4>
                <p style="font-size: 0.8em; color: var(--color-acento-base); font-weight: 600;">C√≥digo de Asistencia Personal e Intransferible</p>
            </div>
            
            <div class="card-info">
                <p>Hermano(a):</p>
                <h5 id="pdfHermanoNombre"></h5>
                <p id="pdfGroupName"></p> 
            </div>
            
            <img src="" alt="Logo de la Cuadrilla/Grupo" class="card-logo" id="pdfHermandadLogo"> 

            <div class="card-qr-container">
                <img src="" alt="C√≥digo QR para PDF" id="pdfQrImage">
            </div>

            <p>Presente este documento para registrar su asistencia.</p>
        </div>
        <div class="pie-pagina">
            <p style="font-size: 0.85em; color: var(--color-acento-oscuro);">Desarrollado para la HSVCL</p>
        </div>
    </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
    const { jsPDF } = window.jspdf;

    // ==========================================================
    // Datos de Prueba (Simulaci√≥n de Base de Datos de Hermanos)
    // ==========================================================
    const BROTHER_DATABASE = {
    // Formato: DNI: { name: 'Nombre', group_id: 'ID_Grupo' }
    // === EJEMPLOS EXISTENTES ===
    '46094780': { name: 'Juan P√©rez L√≥pez', group_id: 16 }, // Cuadrilla 16
    '87654321': { name: 'Mar√≠a Fernanda Garc√≠a', group_id: 'GS' }, // Grupo Sahumadoras
    '11223344': { name: 'Luis Alberto Suarez Sandoval', group_id: 10 }, // Cuadrilla 10
    '99887766': { name: 'Ricardo G√≥mez Salas', group_id: 'GC' }, // Grupo Cantoras
    '44556677': { name: 'Elena Ram√≠rez Ruiz', group_id: 13 }, // Cuadrilla 13
    
    // === GRUPO DE SAHUMADORAS (GS) - (Lista anterior) ===
    '06698109': { name: 'ALCALA BARREDA MARIA DEL CARMEN', group_id: 'GS' },
    '46294216': { name: 'ALVINES DAVILA CYNTHIA KATHERIN', group_id: 'GS' },
    '07034104': { name: 'ARBIETO OSORIO ELSA', group_id: 'GS' },
    '73351596': { name: 'AVALOS HUAPAYA NOELIA DEL PILAR', group_id: 'GS' },
    '06226397': { name: 'BARRANTES ALVARADO MARIA BRIGIDA', group_id: 'GS' },
    '43134345': { name: 'BORDA BARRIONUEVO PAOLA SARA', group_id: 'GS' },
    '06743668': { name: 'CABANILLAS GUERRA LUISA AURORA', group_id: 'GS' },
    '06061365': { name: 'CABANILLAS MUCHA ROXANA MARTHA', group_id: 'GS' },
    '07373988': { name: 'CACERES ROSARIO SONIA MARLENE', group_id: 'GS' },
    '10437677': { name: 'CARBAJAL PAREDES VDA. DE REYNA MARIA ELIZABETH', group_id: 'GS' },
    '06379872': { name: 'CARBONEL CANDELA ROSA OFELIA', group_id: 'GS' },
    '09432592': { name: 'CARDENAS BEDOYA ROSARIO', group_id: 'GS' },
    '71627610': { name: 'CARDOZA GUZMAN MONICA CAROLINA', group_id: 'GS' },
    '08968774': { name: 'CESPEDES GARCIA YSABEL', group_id: 'GS' },
    '07511088': { name: 'CHIRINOS RAMIREZ VERONICA VIRGINIA', group_id: 'GS' },
    '07510023': { name: 'CHUQUISANA HURTADO TATIANA', group_id: 'GS' },
    '06777948': { name: 'CONTRERAS ARANA MARIA FELISITA', group_id: 'GS' },
    '06168820': { name: 'COX MESIAS MARIA ISABEL', group_id: 'GS' },
    '73601188': { name: 'CUCHURI RIVAS DE MARTINEZ MARIA GABRIELA', group_id: 'GS' },
    '70643313': { name: 'CUEVA ALVAREZ, KIMBERLY NAYELI', group_id: 'GS' },
    '25716586': { name: 'DE LA HAZA ALEGRE WENDY MILAGROS', group_id: 'GS' },
    '07216627': { name: 'DIAZ GASTULO MARIA ISABEL', group_id: 'GS' },
    '06213183': { name: 'DIETZ CALDERON MERCEDES', group_id: 'GS' },
    '75525736': { name: 'ECHEGARAY QUI√ëONEZ LUISA YESENIA', group_id: 'GS' },
    '10801764': { name: 'ENCARNACION CRESPIN CLAVERINA', group_id: 'GS' },
    '42728615': { name: 'ESPINOZA CAMPOS MERCEDES', group_id: 'GS' },
    '09326221': { name: 'FERNANDEZ CASANOVA LILIANA PATRICIA', group_id: 'GS' },
    '71947974': { name: 'GARCIA SOLIS LOURDES ESTEFANY', group_id: 'GS' },
    '75372427': { name: 'GARCIA VILLAFUERTE KIMBERLY ALESSANDRA', group_id: 'GS' },
    '07482590': { name: 'GAVILAN CHAVEZ MARIA ANTONIETA', group_id: 'GS' },
    '09937100': { name: 'GIL ZANABRIA GISELL EVELING', group_id: 'GS' },
    '71834133': { name: 'GOMEZ HERRERA DEYANEIRA', group_id: 'GS' },
    '72536307': { name: 'GUERRERO MANCILLA SAMANTHA MARGOT', group_id: 'GS' },
    '08430372': { name: 'GUERRERO TERREROS MARIA DEL CARMEN', group_id: 'GS' },
    '18130932': { name: 'GUTIERREZ VARGAS CARMEN ROSA', group_id: 'GS' },
    '72213811': { name: 'GUZMAN VILLAVICENCIO ERIKA YOLANDA', group_id: 'GS' },
    '10816624': { name: 'HERRERA VALENZUELA SHIRLEY PAMELA', group_id: 'GS' },
    '06961360': { name: 'HUAMAN SANCHEZ ROSA', group_id: 'GS' },
    '70918230': { name: 'JARA ESTRELLA LEONELA GUADALUPE', group_id: 'GS' },
    '06679246': { name: 'JOYA ABURTO MARINA SOLEDAD', group_id: 'GS' },
    '73111286': { name: 'KAM ROCA CARMEN PATRICIA', group_id: 'GS' },
    '46335705': { name: 'LAU OLAYA JENNY KARINA', group_id: 'GS' },
    '44229972': { name: 'LAZO VIVAR JACKELINE BRIGETTE', group_id: 'GS' },
    '07365675': { name: 'LOPEZ ALVAREZ MARTHA ROSAURA', group_id: 'GS' },
    '08112768': { name: 'MATALLANA OTINIANO LEONOR', group_id: 'GS' },
    '41549846': { name: 'MEDINA GAMARRA YULIANA ANGELICA', group_id: 'GS' },
    '40646634': { name: 'MELO AZANERO LILY SANDRA GUILIANA', group_id: 'GS' },
    '09930194': { name: 'MENDOZA DIAZ MARY ANN', group_id: 'GS' },
    '06031114': { name: 'MIRANDA HUAMAN LOURDES ANTONIA', group_id: 'GS' },
    '09357764': { name: 'MONTEVERDE SOLIS CARMEN ROSA YANINA', group_id: 'GS' },
    '47039594': { name: 'MORALES ELGUERA KIARA YESA BELLA', group_id: 'GS' },
    '09684158': { name: 'MORENO SIRIO YENI DEL CARMEN', group_id: 'GS' },
    '07079483': { name: 'MORI HUAMAN VDA. DE CHACALTANA LUPE', group_id: 'GS' },
    '73136899': { name: 'OJEDA CARRILLO MARIA ALEJANDRA', group_id: 'GS' },
    '06234691': { name: 'OLIVARES CACEDA JUANA ROSA', group_id: 'GS' },
    '06160813': { name: 'OLIVARES ORELLANA CECILIA', group_id: 'GS' },
    '44342889': { name: 'ORME√ëO VALENZUELA LESNY ANAMILE', group_id: 'GS' },
    '47374565': { name: 'OROYA ARISTA MARYORIE MERCEDES', group_id: 'GS' },
    '06090457': { name: 'PAIVA MUCHA VDA DE PALACIOS TERESA MARGARITA', group_id: 'GS' },
    '44160029': { name: 'PALOMINO TORRES MANUELA LUCILA', group_id: 'GS' },
    '08255517': { name: 'PARDAVE MARTINEZ MONICA MARGARITA', group_id: 'GS' },
    '06090262': { name: 'PAREDES ARIAS JULIA ZORAIDA', group_id: 'GS' },
    '06171218': { name: 'PAREDES BALAREZO ROSA ELENA', group_id: 'GS' },
    '09231265': { name: 'PELAEZ LAZURTEGUI LEONILA ELVIRA', group_id: 'GS' },
    '09558603': { name: 'PE√ëARES ASENCIO MARIA DEL CARMEN', group_id: 'GS' },
    '06715915': { name: 'PEREZ VEGA SABINA AGUEDA', group_id: 'GS' },
    '07497083': { name: 'PINEDA BELLEZA CARMEN LILIAM', group_id: 'GS' },
    '07371245': { name: 'PINEDA BELLEZA MARGARITA MATILDE', group_id: 'GS' },
    '40202778': { name: 'QUEVEDO RODRIGUEZ OLIMPIA ANGELA', group_id: 'GS' },
    '08183024': { name: 'QUINO PIZARRO CARMEN CECILIA', group_id: 'GS' },
    '74917345': { name: 'QUIROZ DELGADO JARUMI XIOMARA', group_id: 'GS' },
    '07302062': { name: 'RENTERIA KLAUER JUANA ELIZABETH', group_id: 'GS' },
    '46569951': { name: 'REYES BARRANTES MELISSA SUE', group_id: 'GS' },
    '73062945': { name: 'RIEGA GOMEZ VDA. DE MAMANI VALERY NICHOLE', group_id: 'GS' },
    '43477354': { name: 'ROJAS GUZMAN JOHANNA MARIELLA', group_id: 'GS' },
    '09735581': { name: 'ROJAS REYES CARMEN PATRICIA', group_id: 'GS' },
    '06031029': { name: 'ROMANI MORALES TERESA', group_id: 'GS' },
    '75500441': { name: 'ROSALES AGUILAR VALERIA', group_id: 'GS' },
    '42551515': { name: 'ROSAS REYES, VICTORIA MARCELINA', group_id: 'GS' },
    '73628197': { name: 'RUIZ SALDIVAR CARLA KASSANDRA', group_id: 'GS' },
    '06572273': { name: 'SALVATIERRA LARA MIRIAM ESTELA', group_id: 'GS' },
    '07615606': { name: 'SANCHEZ AUBIAN MARIA ADELAIDA', group_id: 'GS' },
    '40883537': { name: 'SANCHEZ GOMEZ SABINA JAZMIN', group_id: 'GS' },
    '43051235': { name: 'SANTIBA√ëEZ SANCHEZ SANDY ELIZABETH', group_id: 'GS' },
    '25629997': { name: 'SILVA PONCE MARIA DEL ROSARIO', group_id: 'GS' },
    '76850999': { name: 'SUAREZ LEIVA, ROSA LUZ', group_id: 'GS' },
    '07610084': { name: 'TEJADA CARRILLO VDA. DE SANCHEZ ISABEL', group_id: 'GS' },
    '43012657': { name: 'TELLO CORA MARISU LAURA', group_id: 'GS' },
    '06649351': { name: 'TORRES ZEVALLOS CARMEN ROSA', group_id: 'GS' },
    '46492028': { name: 'TREJO GARCIA MAYA', group_id: 'GS' },
    '08062169': { name: 'TRIGO VALLEJOS ZOILA', group_id: 'GS' },
    '45880229': { name: 'VALERIO GARCIA IBONNE DEL CARMEN', group_id: 'GS' },
    '06043876': { name: 'VALLE DE MAQUIAVELO EMMA VIRGINIA', group_id: 'GS' },
    '45847827': { name: 'VASQUEZ SANCHEZ CARMEN MELISSA', group_id: 'GS' },
    '06061321': { name: 'VASQUEZ VIUDA DE MANCHINARE JUANA VICTORIA', group_id: 'GS' },
    '08151225': { name: 'VELASQUEZ MENDOZA YULI', group_id: 'GS' },
    '06201731': { name: 'VERA TUDELA GAMERO MARIA LUISA', group_id: 'GS' },
    '72840582': { name: 'VITE SILVA MARIA FERNANDA', group_id: 'GS' },
    '08847489': { name: 'VIVANCO MINA IRMA LUCIA', group_id: 'GS' },
    '07503950': { name: 'WONG MATTA MILAGROS MADELEIGNE', group_id: 'GS' },
    '44180722': { name: 'ZAMBRANO YAURI YANINA JHENIFER', group_id: 'GS' },

    // === DECIMOTERCERA CUADRILLA (13) - NUEVOS DATOS ===
    '07057964': { name: 'ALVAREZ PINEDA, Sergio Luis', group_id: 13 },
    '41181530': { name: 'ARAMBUR√ö LOYAGA, Luis Enrique', group_id: 13 },
    '06460818': { name: 'ARANA VILLEGAS, Julio C√©sar', group_id: 13 },
    '43312355': { name: 'ARDILES MINAYA, Ricardo Alexis', group_id: 13 },
    '09938148': { name: 'AR√âVALO GARCIA, V√≠ctor Mario', group_id: 13 },
    '40285209': { name: 'ARIZA RIQUELME, Anibal Alejandro', group_id: 13 },
    '06245732': { name: 'AYULO ZARATE, C√©sar Enrique', group_id: 13 },
    '07468322': { name: 'BALDEON LOSTAUNAU, Manuel Jes√∫s', group_id: 13 },
    '45895212': { name: 'BARCENA GALLEGOS, Peter Alberto', group_id: 13 },
    '07404433': { name: 'BENITEZ RAMIREZ, Martin Eduardo Giovanni', group_id: 13 },
    '08530304': { name: 'BERNAB√â LOPEZ, Claudio Oscar', group_id: 13 },
    '06957955': { name: 'BUSTAMANTE LARA, Miguel Eugenio', group_id: 13 },
    '06170853': { name: 'CARDENAS ZOLEZZI, Jorge Luis', group_id: 13 },
    '40357769': { name: 'CASAVERDE MARTINEZ, Eduardo Jes√∫s', group_id: 13 },
    '40351769': { name: 'CASAVERDE MARTINEZ, Edwin Antonio', group_id: 13 },
    '42453309': { name: 'CASTILLO SANCHEZ, Fredy Antonio', group_id: 13 },
    '06031830': { name: 'CAVERO RODRIGUEZ, Jos√© Luis', group_id: 13 },
    '44109202': { name: 'CHIRINOS NEYRA, Julio Cesar', group_id: 13 },
    '41258385': { name: 'CHOCHOCA CARRI√ìN, Jorge Eduardo', group_id: 13 },
    '06225796': { name: 'CHOCLOT ROJAS, Rub√©n', group_id: 13 },
    '71693639': { name: 'CHOY ROBLES, Richard David', group_id: 13 },
    '42397041': { name: 'COLOMA ALCALDE, Jos√© Ricardo', group_id: 13 },
    '09780244': { name: 'CORNEJO PODESTA, Carlos', group_id: 13 },
    '25824470': { name: 'COSTA ECHEVARRIA, Francisco', group_id: 13 },
    '42756747': { name: 'CUBILLAS RAMOS, Nelson Jes√∫s', group_id: 13 },
    '06027275': { name: 'DANERI FRANCIA, R√≥mulo Rigoberto', group_id: 13 },
    '07857895': { name: 'DEL POZO CORDERO, Pedro Te√≥filo', group_id: 13 },
    '09955556': { name: 'DONGO MENESES, Jonathan Anthony', group_id: 13 },
    '07410812': { name: 'ESCALANTE MARROQU√çN, Jos√© Francisco', group_id: 13 },
    '06242610': { name: 'ESTELA DIAZ, Indalecio', group_id: 13 },
    '08061503': { name: 'GOMEZ AREVALO, Juan Manuel', group_id: 13 },
    '41367701': { name: 'GOMEZ FARACH, Farid Naim', group_id: 13 },
    '70782975': { name: 'GONZALES PACORA, Diego Alonso', group_id: 13 },
    '72747125': { name: 'GUTIERREZ CHONG, Walter Alfonso', group_id: 13 },
    '47858661': { name: 'GUZM√ÅN HONORES, Gonzalo', group_id: 13 },
    '06088652': { name: 'LA ROSA CARRILLO, Julio Ernesto', group_id: 13 },
    '09429351': { name: 'LAY ZAPATA, Carlos Roberto', group_id: 13 },
    '10801424': { name: 'L√ìPEZ VELA, Jos√© Antonio', group_id: 13 },
    '07068446': { name: 'L√ìPEZ ZEGARRA, Enrique', group_id: 13 },
    '06216621': { name: 'LUJAN ROMAN, Brick Iv√°n', group_id: 13 },
    '08255768': { name: 'MALAGA CALDERON, Guido', group_id: 13 },
    '06041958': { name: 'MARTINEZ LLANOS, Augusto Fernando', group_id: 13 },
    '07457508': { name: 'MEDINA GALVEZ, Ernesto Manuel', group_id: 13 },
    '43378781': { name: 'MEDINA GALVEZ, Juan Carlos', group_id: 13 },
    '07382037': { name: 'MEDINA TORALES, Juan √Ångel', group_id: 13 },
    '07456736': { name: 'MEDINA TORALES, Marco Antonio', group_id: 13 },
    '07530103': { name: 'MEDINA TORALES, Miguel √Ångel', group_id: 13 },
    '09567320': { name: 'MELENDEZ SALCEDO, Luis Alberto', group_id: 13 },
    '09101684': { name: 'MONTALVO CORREA, Juan Jes√∫s', group_id: 13 },
    '72299877': { name: 'MONTOYA MARCHINARES, Brayan', group_id: 13 },
    '07418182': { name: 'MORALES ARRILUZ, Manuel El√≠as', group_id: 13 },
    '09942278': { name: 'MORALES ISA, Jorge Alberto', group_id: 13 },
    '07945199': { name: 'MORALES MACPHERSON, Ysaac V√≠ctor', group_id: 13 },
    '09953226': { name: 'NUE SOSA, Rodolfo Germ√°n', group_id: 13 },
    '07846582': { name: 'OBLITAS BALDARRAGO, Edgard Cesar Hugo', group_id: 13 },
    '07847804': { name: 'OBREG√ìN BERROSPI, Ra√∫l Ricardo', group_id: 13 },
    '22314433': { name: 'ORME√ëO TORREALVA, Victor Leonidas', group_id: 13 },
    '70827521': { name: 'PONZONI REYES, Harold Jeanfranco', group_id: 13 },
    '09965357': { name: 'QUESQU√âN QUIROZ, Hern√°n Flavio', group_id: 13 },
    '07847051': { name: 'QUINTANA QUICO, Jorge Arturo', group_id: 13 },
    '71020468': { name: 'RAMIREZ REPPO, Carlos Alonso', group_id: 13 },
    '06015376': { name: 'RAMOS COSSIO, Fernando Daniel', group_id: 13 },
    '06043036': { name: 'RAMOS COSSIO, Jorge Alfonso', group_id: 13 },
    '06032576': { name: 'RAMOS COSSIO, Luis Alberto', group_id: 13 },
    '42825140': { name: 'RAMOS DELGADO, Mois√©s Hilari√≥n', group_id: 13 },
    '06063772': { name: 'RAMOS FRANCO, Oscar Richard', group_id: 13 },
    '46844483': { name: 'RAMOS MENDOZA, Renzo', group_id: 13 },
    '06771178': { name: 'ROBLEDILLO SHARFFE; C√©sar Adolfo', group_id: 13 },
    '42986674': { name: 'RODRIGUEZ BORROVICH, Julio Cesar', group_id: 13 },
    '07339217': { name: 'RODRIGUEZ CHUY, Jorge Antonio', group_id: 13 },
    '43411632': { name: 'RODRIGUEZ LIMAS, Jos√© Martin', group_id: 13 },
    '08170552': { name: 'RODRIGUEZ LIMAS, Luis Pedro', group_id: 13 },
    '43251345': { name: 'RODRIGUEZ S√ÅNCHEZ, Enrique Antonio', group_id: 13 },
    '07426541': { name: 'RODRIGUEZ V√ÅSQUEZ, Cesar Alberto', group_id: 13 },
    '07429783': { name: 'RODRIGUEZ V√ÅSQUEZ, Luis Manuel', group_id: 13 },
    '10683869': { name: 'ROJAS BARRERA, Fernando', group_id: 13 },
    '72715870': { name: 'ROSELL SINARAHUA, Andr√©s Rolando', group_id: 13 },
    '08760827': { name: 'SANCHEZ LOPEZ, Fernando Flavio', group_id: 13 },
    '08694353': { name: 'SANCHO RAYMUNDO, Helbert Denyz', group_id: 13 },
    '06282377': { name: 'SANDOVAL RIOS, Wilmer C√©sar', group_id: 13 },
    '07278563': { name: 'SILVA ROSELL, Juan Pablo', group_id: 13 },
    '27077299': { name: 'TELLO VILLAR, C√©sar Antonio', group_id: 13 },
    '42722269': { name: 'TORRES HERRERA, Jonathan Joseph', group_id: 13 },
    '40508469': { name: 'URIONDO MINAYA, William Ferm√≠n', group_id: 13 },
    '42191844': { name: 'VALERIO GARC√çA, Walter Jes√∫s Martin', group_id: 13 },
    '42342719': { name: 'VALERIO GUTI√âRREZ, Walter Liberato', group_id: 13 },
    '10504470': { name: 'VARGAS KOO, Arturo Antonio', group_id: 13 },
    '09956051': { name: 'V√ÅSQUEZ COSS√çO, Dumas F√©lix', group_id: 13 },
    '72897350': { name: 'VASQUEZ FERNANDEZ, Victor Enrique', group_id: 13 },
    '08644491': { name: 'VIDAL MENDIETA, Carlos Alberto', group_id: 13 },
    '76234296': { name: 'WALDE RODRIGUEZ, Diego Alonso', group_id: 13 },
         "46592606": { "name": "ANGULO CAMPOS, Cristofher Miguel", "group_id": 10 },
    "06227976": { "name": "AYALA LEYVA, Rafael Ren√©", "group_id": 10 },
    "45789628": { "name": "C√ÅCEDA FERN√ÅNDEZ, Carlos Alberto A.", "group_id": 10 },
    "06012971": { "name": "C√ÅCEDA LAURI, Sergio √Ålvaro", "group_id": 10 },
    "48509340": { "name": "CAMASCA MITMA, Jos√© Julio", "group_id": 10 },
    "70286463": { "name": "CAMPOS MILLARES, V√≠ctor Armando", "group_id": 10 },
    "25704861": { "name": "CARHUAMACA PARDO, Hugo Luis", "group_id": 10 },
    "10612368": { "name": "CASTRO ALVA, Jos√© Luis", "group_id": 10 },
    "40229083": { "name": "CHAVARRI ZAMBRANO, Humberto Iv√°n", "group_id": 10 },
    "09946140": { "name": "CHAVARRI ZAMBRANO, Luis Gustavo", "group_id": 10 },
    "76188505": { "name": "CHUMO GIL, Luis Iv√°n", "group_id": 10 },
    "45989290": { "name": "CHUNGA SOTO, Javier Steven", "group_id": 10 },
    "10878149": { "name": "CIUDAD AMAYA, √Ångel Martin", "group_id": 10 },
    "45221337": { "name": "CRESPO PIZARRO, √Ångel Daniel", "group_id": 10 },
    "70562492": { "name": "DE PAZ BENAVIDES, Edward Michael", "group_id": 10 },
    "73641755": { "name": "DONAYRE APOLAYA, El√≠as", "group_id": 10 },
    "45032864": { "name": "FERN√ÅNDEZ PE√ëALOZA, Francesco", "group_id": 10 },
    "09969059": { "name": "GIRALDO QUISPE, Marco Antonio", "group_id": 10 },
    "70911092": { "name": "G√ìMEZ GARCIA, Matthew Ra√∫l", "group_id": 10 },
    "07403504": { "name": "G√ìMEZ PADILLA, Juan Carlos", "group_id": 10 },
    "45982718": { "name": "HENRIQUEZ ALCEDO, Jerson Alejandro", "group_id": 10 },
    "09491646": { "name": "HEREDIA RODRIGUEZ, Percy Dorian", "group_id": 10 },
    "47704784": { "name": "HINOSTROZA SALAZAR, Julio Martin", "group_id": 10 },
    "45120127": { "name": "IBARRA REQUEJO, Ad√°n Jes√∫s", "group_id": 10 },
    "40491110": { "name": "KOBASHIKAWA SUYON, C√©sar Augusto", "group_id": 10 },
    "09959028": { "name": "LA RIVA BELL, Aldo Ricardo", "group_id": 10 },
    "49021293": { "name": "LA RIVA MUGABURU, David Jes√∫s", "group_id": 10 },
    "48536651": { "name": "LA RIVA MUGABURU, Israel Jair", "group_id": 10 },
    "90817861": { "name": "LA RIVA MUGABURU, Juan Agust√≠n", "group_id": 10 },
    "44165815": { "name": "LOZADA BAUTISTA, Juan Ernesto", "group_id": 10 },
    "43193520": { "name": "MAQUEN MU√ëOZ, Juan Pablo", "group_id": 10 },
    "42198642": { "name": "MARTINEZ L√ìPEZ, Jos√© Luis", "group_id": 10 },
    "72380816": { "name": "OL√ìRTEGUI SALAZAR, Richard Antonio", "group_id": 10 },
    "07529808": { "name": "ORREGO SILVA, Gino Paul", "group_id": 10 },
    "07961302": { "name": "ORTIZ ORTIZ, Humberto Manuel", "group_id": 10 },
    "70736649": { "name": "PALOMINO RAM√çREZ, Esteban Andr√©", "group_id": 10 },
    "09472269": { "name": "ROSADO OLIVERA, Miguel √Ångel", "group_id": 10 },
    "09940945": { "name": "ROSAS PE√ëA, C√©sar Javier", "group_id": 10 },
    "40966865": { "name": "RUIZ ATAUJE, Darwin Yor", "group_id": 10 },
    "09444632": { "name": "RUIZ BODENHEIM, Erich Hans", "group_id": 10 },
    "17446057": { "name": "RUIZ ESCALANTE, V√≠ctor Manuel", "group_id": 10 },
    "10724302": { "name": "S√ÅNCHEZ AYALA, Carlos Santiago", "group_id": 10 },
    "41429691": { "name": "S√ÅNCHEZ AYALA, V√≠ctor Manuel", "group_id": 10 },
    "42622168": { "name": "SORIA ROSAS, Augusto Juan", "group_id": 10 },
    "46491697": { "name": "TELLO MARCELO, R√≥mulo Guillermo", "group_id": 10 },
    "43202876": { "name": "TELLO SORIA, Ivar", "group_id": 10 },
    "74743024": { "name": "UCEDA PAREDEZ, Edinsson", "group_id": 10 },
    "09427588": { "name": "VILLANUEVA ARANA, Rub√©n Alberto", "group_id": 10 },
    "73122973": { "name": "VILLAR GAMONAL, Emanuel Mijael", "group_id": 10 },
    "72951110": { "name": "ZAPATA VASQUEZ, Camilo Sebastian", "group_id": 10 },
    "70507696": { "name": "ZAVALA TORRES, Yuri Vladimir", "group_id": 10 },

    /* Registros con DNI pendiente (ahora con group_id: 10) */
    "PEND_ALPACA": { "name": "ALPACA MURGA, Catalino Carlos √Ångel", "group_id": 10 },
    "PEND_ALVAREZ": { "name": "ALVAREZ PRETELL, Brayan Jes√∫s", "group_id": 10 },
    "PEND_BRENA": { "name": "BRE√ëA TUR√çN, Jonathan", "group_id": 10 },
    "PEND_BUENO": { "name": "BUENO OLIVOS, Carlos Alberto", "group_id": 10 },
    "PEND_CABALLERO": { "name": "CABALLERO TEJEDA, Segundo Jes√∫s", "group_id": 10 },
    "PEND_CACEDA_WALTER": { "name": "C√ÅCEDA LAURI, Walter Manuel", "group_id": 10 },
    "PEND_CANALES": { "name": "CANALES FIESTAS, Giancarlo Alexander", "group_id": 10 },
    "PEND_CARRANZA": { "name": "CARRANZA LE√ìN, √Ångel Alberto", "group_id": 10 },
    "PEND_CASTRO_LAZO": { "name": "CASTRO LAZO, Luis Arnaldo", "group_id": 10 },
    "PEND_CHAVARRI_OLIVOS": { "name": "CHAVARRI OLIVOS, Luis Humberto", "group_id": 10 },
    "PEND_CUBA": { "name": "CUBA PI√ëA, Hugo Yordany", "group_id": 10 },
    "PEND_DE_LA_CALLE_FELIX_ARMANDO": { "name": "DE LA CALLE FALC√ìN, F√©lix Armando", "group_id": 10 },
    "PEND_DE_LA_CALLE_ORTIZ": { "name": "DE LA CALLE ORTIZ, F√©lix Armando", "group_id": 10 },
    "PEND_DE_LA_CRUZ": { "name": "DE LA CRUZ RAMOS, Christian", "group_id": 10 },
    "PEND_EGUES": { "name": "EG√úES PINTO, Alexander Gonzalo", "group_id": 10 },
    "PEND_ELORREAGA": { "name": "ELORREAGA GARC√çA, Juan", "group_id": 10 },
    "PEND_ENTRADES": { "name": "ENTRADES CASTA√ëEDA, Joaqu√≠n Alfredo", "group_id": 10 },
    "PEND_FLORES_MALDONADO": { "name": "FLORES MALDONADO, Juan Ignacio", "group_id": 10 },
    "PEND_FLORES_NICHO": { "name": "FLORES NICHO, Pablo H√©ctor", "group_id": 10 },
    "PEND_FONKEN": { "name": "FONKEN OVIEDO, Miguel √Ångel", "group_id": 10 },
    "PEND_GONZALES_VALDIVIESO": { "name": "G√ìNZALES VALDIVIESO, Ra√∫l Di√≥genes", "group_id": 10 },
    "PEND_GUERRA": { "name": "GUERRA CASAS, Edwin Mart√≠n", "group_id": 10 },
    "PEND_LA_RIVA_MONTOYA_DANIEL": { "name": "LA RIVA MONTOYA, Daniel Teodoro", "group_id": 10 },
    "PEND_LA_RIVA_MONTOYA_NEMESIO": { "name": "LA RIVA MONTOYA, Nemesio Ricardo", "group_id": 10 },
    "PEND_LARREA": { "name": "LARREA GUTI√âRREZ, Valentin", "group_id": 10 },
    "PEND_LOPEZ_ERSKINE": { "name": "L√ìPEZ ERSKINE, Juan Antonio", "group_id": 10 },
    "PEND_LUZA": { "name": "LUZA ESPINOZA, Guillermo Luis", "group_id": 10 },
    "PEND_MANRIQUE": { "name": "MANRIQUE RODRIGUEZ, Pedro Isidro", "group_id": 10 },
    "PEND_MORA_PARODI": { "name": "MORA PARODI, Miguel Alexander", "group_id": 10 },
    "PEND_MU√ëIZ": { "name": "MU√ëIZ CHAVARR√ç, Juan Francisco", "group_id": 10 },
    "PEND_ORMENO": { "name": "ORME√ëO ALV√ÅN, Giulio Anthony", "group_id": 10 },
    "PEND_PACHECO": { "name": "PACHECO DEL VALLE, C√©sar Esteban", "group_id": 10 },
    "PEND_PAZ_WINCHEZ": { "name": "PAZ WINCHEZ, Harold", "group_id": 10 },
    "PEND_PRETELL_GALVINS": { "name": "PRETELL GALVINS, Humberto Santiago", "group_id": 10 },
    "PEND_PRETELL_SILVA": { "name": "PRETELL SILVA, Humberto Jos√© Martin", "group_id": 10 },
    "PEND_RAZZETTO": { "name": "RAZZETTO BARRUETO, Renato Alfredo", "group_id": 10 },
    "PEND_RIVASPLATA": { "name": "RIVASPLATA GARC√çA, Ricardo Charlie", "group_id": 10 },
    "PEND_RODRIGUEZ_MANCILLA": { "name": "RODRIGUEZ MANCILLA, Juan Gustavo", "group_id": 10 },
    "PEND_RUIZ_CUYA": { "name": "RUIZ CUYA, V√≠ctor Walter", "group_id": 10 },
    "PEND_SANTOS": { "name": "SANTOS CHACARA, Alexander Hans", "group_id": 10 },
    "PEND_SILVA_ANICETO": { "name": "SILVA ANICETO, Sebasti√°n", "group_id": 10 },
    "PEND_TALLEDO": { "name": "TALLEDO BUEND√çA, Alexander Manuel", "group_id": 10 },
    "PEND_TUESTA": { "name": "TUESTA C√ìNDOR, Pablo", "group_id": 10 },
    "PEND_VARGAS_VILLEGAS": { "name": "VARGAS VILLEGAS, Augusto Martin", "group_id": 10 },
    "PEND_ZUNIGA_FLORES_HENRY": { "name": "ZU√ëIGA FLORES, Henry Luis", "group_id": 10 },
    "PEND_ZUNIGA_FLORES_HERBERT": { "name": "ZU√ëIGA FLORES, Herbert C√©sar", "group_id": 10 }
}
    // Mapeo para obtener el nombre completo y el sufijo para el logo
    const GROUP_MAP = {
        1: { name: 'Primera Cuadrilla', logo_suffix: '1_.png' },
        2: { name: 'Segunda Cuadrilla', logo_suffix: '2_.png' },
        3: { name: 'Tercera Cuadrilla', logo_suffix: '3_.png' },
        4: { name: 'Cuarta Cuadrilla', logo_suffix: '4_.png' },
        5: { name: 'Quinta Cuadrilla', logo_suffix: '5_.png' },
        6: { name: 'Sexta Cuadrilla', logo_suffix: '6_.png' },
        7: { name: 'S√©ptima Cuadrilla', logo_suffix: '7_.png' },
        8: { name: 'Octava Cuadrilla', logo_suffix: '8_.png' },
        9: { name: 'Novena Cuadrilla', logo_suffix: '9_.png' },
        10: { name: 'D√©cima Cuadrilla', logo_suffix: '10_.png' },
        11: { name: 'D√©cima Primera Cuadrilla', logo_suffix: '11_.png' },
        12: { name: 'D√©cima Segunda Cuadrilla', logo_suffix: '12_.png' },
        13: { name: 'D√©cima Tercera Cuadrilla', logo_suffix: '13_.png' },
        14: { name: 'D√©cima Cuarta Cuadrilla', logo_suffix: '14_.png' },
        15: { name: 'D√©cima Quinta Cuadrilla', logo_suffix: '15_.png' },
        16: { name: 'D√©cima Sexta Cuadrilla', logo_suffix: '16_.png' },
        17: { name: 'D√©cima S√©ptima Cuadrilla', logo_suffix: '17_.png' },
        18: { name: 'D√©cima Octava Cuadrilla', logo_suffix: '18_.png' },
        19: { name: 'D√©cima Novena Cuadrilla', logo_suffix: '19_.png' },
        20: { name: 'Vig√©sima Cuadrilla', logo_suffix: '20_.png' },
        'GS': { name: 'Grupo de Sahumadoras', logo_suffix: 'gs_.png' },
        'GC': { name: 'Grupo de Cantoras', logo_suffix: 'gc_.png' }
       
    };
    
    // Almacenamiento temporal de los datos del hermano verificado
    let verifiedBrotherData = null;
    const defaultLogoUrl = 'https://edwinhsvcl14-maker.github.io/asistencias/logo_hermandad.png';


    // Funci√≥n para generar la URL del logo din√°micamente
    function generateLogoUrl(group_id) {
        const base_url = 'https://edwinhsvcl14-maker.github.io/asistencias/'; 
        const map = GROUP_MAP[group_id];
        
        if (map) {
            return `${base_url}${map.logo_suffix}`;
        }
        return defaultLogoUrl; 
    }

    // Funci√≥n para obtener el texto condicional de pertenencia
    function getGroupPrefixText(group_id) {
        if (group_id === 'GS' || group_id === 'GC') {
            return 'Pertenece a:'; // Para Grupos (Sahumadoras, Cantoras)
        } else if (typeof group_id === 'number' && group_id >= 1 && group_id <= 20) {
            return 'Perteneciente a la:'; // Para Cuadrillas
        }
        return 'Perteneciente a la:'; // Por defecto
    }

    // ==========================================================
    // L√≥gica de Preloader y Carga
    // ==========================================================
    window.addEventListener('load', () => {
        const preloader = document.getElementById('preloader');
        const mainContainer = document.getElementById('mainContainer');
        
        // El h2 por defecto es el nombre de la hermandad
        document.getElementById('headerGroupName').textContent = 'Hermandad de la Sant√≠sima Virgen del Carmen de Lima';

        preloader.classList.add('hidden');
        setTimeout(() => {
            mainContainer.classList.add('visible');
        }, 1000); 
    });

    // ==========================================================
    // L√≥gica de Transici√≥n de Fases
    // ==========================================================
    let currentStep = 1;

    function nextStep(stepNumber) {
        if (stepNumber === currentStep) return;
        
        const currentContent = document.getElementById(`step${currentStep}`);
        const nextContent = document.getElementById(`step${stepNumber}`);

        if (!currentContent || !nextContent) return;

        const exitClass = stepNumber > currentStep ? 'exit-left' : 'exit-right';
        const enterClass = stepNumber > currentStep ? 'enter-right' : 'enter-left';

        currentContent.classList.remove('active');
        currentContent.classList.add(exitClass);
        
        nextContent.classList.add(enterClass);
        
        setTimeout(() => {
            currentContent.classList.remove(exitClass);
            currentContent.classList.remove('enter-left');
            
            nextContent.classList.remove(enterClass);
            nextContent.classList.add('active');
            
            currentStep = stepNumber;

            if (stepNumber === 1) {
                document.getElementById('dniInput').value = '';
                document.getElementById('error-message').style.display = 'none';
                verifiedBrotherData = null; // Limpiar datos de sesi√≥n
                // Restaurar texto del encabezado al estado por defecto
                document.getElementById('headerGroupName').textContent = 'Hermandad de la Sant√≠sima Virgen del Carmen de Lima';
            }
        }, 500);
    }

    // ==========================================================
    // L√≥gica de Verificaci√≥n (Paso 2)
    // ==========================================================

    function verifyDNI() {
        const dniInput = document.getElementById('dniInput');
        const errorMessage = document.getElementById('error-message');
        const dni = dniInput.value.trim();
        
        errorMessage.style.display = 'none';
        
        if (dni.length !== 8 || isNaN(dni)) {
            errorMessage.textContent = '‚ùå El DNI debe contener exactamente 8 d√≠gitos num√©ricos.';
            errorMessage.style.display = 'block';
            return;
        }

        const btnSearch = document.querySelector('#step2 .btn-main');
        
        btnSearch.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verificando...';
        btnSearch.disabled = true;
        dniInput.disabled = true;

        setTimeout(() => {
            const brother = BROTHER_DATABASE[dni];
            
            if (brother) {
                verifiedBrotherData = brother; // Guardar datos
                const groupInfo = GROUP_MAP[brother.group_id];
                const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${dni}`;
                const groupName = groupInfo.name;
                const groupLogoUrl = generateLogoUrl(brother.group_id);
                const groupPrefixText = getGroupPrefixText(brother.group_id); // Obtener prefijo condicional

                // 1. Fase Visible (Paso 3)
                document.getElementById('hermanoNombre').textContent = brother.name;
                document.getElementById('verifiedGroupName').textContent = `${groupPrefixText} ${groupName}`; // Usar prefijo condicional
                document.getElementById('qrImage').src = qrUrl;

                // 2. Formato Oculto (PDF)
                document.getElementById('pdfHermanoNombre').textContent = brother.name;
                document.getElementById('pdfGroupName').textContent = `${groupPrefixText} ${groupName}`; // Usar prefijo condicional
                document.getElementById('pdfQrImage').src = qrUrl;
                document.getElementById('pdfHermandadLogo').src = groupLogoUrl; // Logo din√°mico en el PDF

                // 3. Encabezado del Sistema (Se mantiene est√°tico o se actualiza solo el subt√≠tulo)
                document.getElementById('headerGroupName').textContent = `${groupName}`; // Muestra el nombre del grupo en el subt√≠tulo del encabezado.

                // √âXITO
                nextStep(3);
                
            } else {
                // ERROR (Usando SweetAlert2)
                Swal.fire({
                    icon: 'error',
                    title: '¬°Hermano No Encontrado!',
                    text: `El DNI ${dni} no est√° registrado. Verifique el n√∫mero o contacte a la Cuadrilla.`,
                    confirmButtonText: 'Entendido'
                });
                errorMessage.textContent = `üö´ Hermano con DNI ${dni} no encontrado.`;
                errorMessage.style.display = 'block';
            }
            
            btnSearch.innerHTML = '<i class="fas fa-search"></i> Buscar Hermano(a)';
            btnSearch.disabled = false;
            dniInput.disabled = false;
            
        }, 3000); 
    }

    // ==========================================================
    // L√≥gica de GENERACI√ìN Y DESCARGA DE PDF (Paso 3) - A4 GRANDE
    // ==========================================================
    async function downloadPDF() {
        if (!verifiedBrotherData) {
             Swal.fire({
                icon: 'warning',
                title: 'Error de Sesi√≥n',
                text: 'No se encontraron datos de hermano. Por favor, reinicie el proceso.',
                confirmButtonText: 'Reiniciar'
            }).then(() => nextStep(1));
            return;
        }

        const dni = document.getElementById('dniInput').value.trim();
        const hermanoName = verifiedBrotherData.name;

        const inputElement = document.getElementById('qrCardFormat');
        
        const downloadButton = document.querySelector('#step3 .btn-main');
        downloadButton.innerHTML = '<i class="fas fa-file-export fa-spin"></i> Generando PDF...';
        downloadButton.disabled = true;

        try {
            // 1. Capturar el contenido HTML del formato oculto 
            const canvas = await html2canvas(inputElement, { 
                scale: 2, 
                useCORS: true
            });

            const imgData = canvas.toDataURL('image/jpeg', 0.9); 

            // 2. Crear el documento PDF en formato A4
            const doc = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: 'a4' 
            });

            const pdfWidth = doc.internal.pageSize.getWidth(); 

            // Dimensiones para la tarjeta en A4: Reducci√≥n del tama√±o para asegurar el margen
            const targetWidthMM = 140; 
            const imgHeightMM = (canvas.height * targetWidthMM) / canvas.width;
            
            // Centrado en A4 y margen superior (15mm)
            const xOffset = (pdfWidth - targetWidthMM) / 2;
            const yOffset = 15; 

            // 3. A√±adir la imagen (tarjeta) al PDF, centrada y grande
            doc.addImage(imgData, 'JPEG', xOffset, yOffset, targetWidthMM, imgHeightMM); 

            // 4. Descargar el archivo
            const groupPrefix = GROUP_MAP[verifiedBrotherData.group_id].name.replace(/\s/g, '_');
            doc.save(`Tarjeta_QR_${groupPrefix}_${hermanoName.replace(/\s/g, '_')}_${dni}.pdf`);
            
            // √âXITO (Usando SweetAlert2)
            Swal.fire({
                icon: 'success',
                title: '¬°Descarga Exitosa!',
                text: `La Tarjeta QR de ${hermanoName} ha sido generada en formato A4 y descargada.`,
                confirmButtonText: 'Cerrar'
            });

        } catch (error) {
            console.error('Error al generar el PDF:', error);
             // ERROR (Usando SweetAlert2)
             Swal.fire({
                icon: 'error',
                title: 'Error de Generaci√≥n',
                text: 'Ocurri√≥ un error al generar el PDF. Revise la consola (F12) o intente de nuevo.',
                confirmButtonText: 'Aceptar'
            });
        } finally {
            // 5. Restaurar el bot√≥n
            downloadButton.innerHTML = '<i class="fas fa-file-pdf"></i> Descargar Tarjeta QR (PDF)';
            downloadButton.disabled = false;
        }
    }
    
    // Limitar el input DNI a solo n√∫meros
    document.addEventListener('DOMContentLoaded', () => {
        const dniInput = document.getElementById('dniInput');
        if (dniInput) {
            dniInput.addEventListener('input', function(e) {
                e.target.value = e.target.value.replace(/[^0-9]/g, '').slice(0, 8);
            });
        }
    });

</script>

</body>
</html>
